<!DOCTYPE html>

<html>
<head>
  <title>matchingUtil.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="Gruntfile.html">
                  Gruntfile.js
                </a>
              
                
                <a class="source" href="audio.html">
                  audio.js
                </a>
              
                
                <a class="source" href="execShellCommand.html">
                  execShellCommand.js
                </a>
              
                
                <a class="source" href="buildCommands.html">
                  buildCommands.js
                </a>
              
                
                <a class="source" href="commandsCTRL.html">
                  commandsCTRL.js
                </a>
              
                
                <a class="source" href="phrases.html">
                  phrases.js
                </a>
              
                
                <a class="source" href="saveAndWrite.html">
                  saveAndWrite.js
                </a>
              
                
                <a class="source" href="updateCommands.html">
                  updateCommands.js
                </a>
              
                
                <a class="source" href="configUtils.html">
                  configUtils.js
                </a>
              
                
                <a class="source" href="cmdRec.html">
                  cmdRec.js
                </a>
              
                
                <a class="source" href="listener.html">
                  listener.js
                </a>
              
                
                <a class="source" href="prefixRec.html">
                  prefixRec.js
                </a>
              
                
                <a class="source" href="speechRecognition.html">
                  speechRecognition.js
                </a>
              
                
                <a class="source" href="formatVariable.html">
                  formatVariable.js
                </a>
              
                
                <a class="source" href="matchCtrl.html">
                  matchCtrl.js
                </a>
              
                
                <a class="source" href="matchingUtil.html">
                  matchingUtil.js
                </a>
              
                
                <a class="source" href="parseCommands.html">
                  parseCommands.js
                </a>
              
                
                <a class="source" href="prefixTrie.html">
                  prefixTrie.js
                </a>
              
                
                <a class="source" href="regMatch.html">
                  regMatch.js
                </a>
              
                
                <a class="source" href="JWDTest.html">
                  JWDTest.js
                </a>
              
                
                <a class="source" href="getMatchByScore.html">
                  getMatchByScore.js
                </a>
              
                
                <a class="source" href="phoneticsTest.html">
                  phoneticsTest.js
                </a>
              
                
                <a class="source" href="testCommands.html">
                  testCommands.js
                </a>
              
                
                <a class="source" href="core-utils.html">
                  core-utils.js
                </a>
              
                
                <a class="source" href="loaders.html">
                  loaders.js
                </a>
              
                
                <a class="source" href="phraseTrie.html">
                  phraseTrie.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="actions.html">
                  actions.js
                </a>
              
                
                <a class="source" href="about.html">
                  about.js
                </a>
              
                
                <a class="source" href="appContainer.html">
                  appContainer.js
                </a>
              
                
                <a class="source" href="contact.html">
                  contact.js
                </a>
              
                
                <a class="source" href="landing.html">
                  landing.js
                </a>
              
                
                <a class="source" href="layout.html">
                  layout.js
                </a>
              
                
                <a class="source" href="commandsTable.html">
                  commandsTable.js
                </a>
              
                
                <a class="source" href="packages.html">
                  packages.js
                </a>
              
                
                <a class="source" href="settings.html">
                  settings.js
                </a>
              
                
                <a class="source" href="constants.html">
                  constants.js
                </a>
              
                
                <a class="source" href="dispatcher.html">
                  dispatcher.js
                </a>
              
                
                <a class="source" href="main.html">
                  main.js
                </a>
              
                
                <a class="source" href="mixins.html">
                  mixins.js
                </a>
              
                
                <a class="source" href="store.html">
                  store.js
                </a>
              
                
                <a class="source" href="storeActions.html">
                  storeActions.js
                </a>
              
                
                <a class="source" href="main.html">
                  main.js
                </a>
              
                
                <a class="source" href="commands-util.spec.html">
                  commands-util.spec.js
                </a>
              
                
                <a class="source" href="matching.spec.html">
                  matching.spec.js
                </a>
              
                
                <a class="source" href="parsing.spec.html">
                  parsing.spec.js
                </a>
              
                
                <a class="source" href="phraseTrie.spec.html">
                  phraseTrie.spec.js
                </a>
              
                
                <a class="source" href="commands.html">
                  commands.js
                </a>
              
                
                <a class="source" href="matching-test-cases.html">
                  matching-test-cases.js
                </a>
              
                
                <a class="source" href="phrases-tmp.html">
                  phrases-tmp.js
                </a>
              
                
                <a class="source" href="webpack.config.html">
                  webpack.config.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>matchingUtil.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> natural = <span class="hljs-built_in">require</span>(<span class="hljs-string">'natural'</span>);
<span class="hljs-keyword">var</span> formatVariable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./formatVariable'</span>);
<span class="hljs-keyword">var</span> testCommands = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./testers/testCommands'</span>);
<span class="hljs-keyword">var</span> getMatchByScore = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./testers/getMatchByScore'</span>);
<span class="hljs-keyword">var</span> phoneticsTest = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./testers/phoneticsTest'</span>);
<span class="hljs-keyword">var</span> JWDTest = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./testers/JWDTest'</span>);
<span class="hljs-keyword">var</span> findCommand = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils/phraseTrie'</span>).findCommand;
<span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils/utils'</span>);



<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">actionPrefix, variable, commandsObj</span>) </span>{
  <span class="hljs-keyword">var</span> _actionPrefix = actionPrefix.toLowerCase();
  <span class="hljs-keyword">var</span> actionObj = {};
  actionObj.exact = <span class="hljs-literal">false</span>;
  actionObj.userCommand = actionPrefix;
  actionObj.guessedCommand = <span class="hljs-literal">null</span>;
  actionObj.action = <span class="hljs-string">''</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p> Mocking localStorage when in test env.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (process.env.NODE_ENV !== <span class="hljs-string">'test'</span>) {
    <span class="hljs-keyword">var</span> exactMatchThreshold = <span class="hljs-built_in">parseFloat</span>(utils.get(<span class="hljs-string">'exactMatchThreshold'</span>));
    <span class="hljs-keyword">var</span> closeMatchThreshold = <span class="hljs-built_in">parseFloat</span>(utils.get(<span class="hljs-string">'closeMatchThreshold'</span>));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> exactMatchThreshold = <span class="hljs-number">0.8</span>;
    <span class="hljs-keyword">var</span> closeMatchThreshold = <span class="hljs-number">0.5</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p> Destructuring the commandsObj</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> phrases = commandsObj.phrases;
  <span class="hljs-keyword">var</span> actions = commandsObj.rawCommands;
  <span class="hljs-keyword">var</span> argCommands = commandsObj.parsedCommands.argCommands;
  <span class="hljs-keyword">var</span> exactCommands = commandsObj.parsedCommands.exactCommands;
  <span class="hljs-keyword">var</span> testPhrase = testCommands(actions, _actionPrefix);

  <span class="hljs-keyword">if</span> (actions[_actionPrefix] !== <span class="hljs-literal">undefined</span> || actions[testPhrase]) {
    actionObj.exact = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (variable &amp;&amp; argCommands[_actionPrefix]) {
      actionObj.action = formatVariable(_actionPrefix, argCommands[_actionPrefix], variable, commandsObj);
    } <span class="hljs-keyword">else</span> {
      actionObj.action = exactCommands[_actionPrefix];
    }
    <span class="hljs-keyword">return</span> actionObj;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>findCommand</p>
<p>looks in the phrases trie for a known match that jarvis had previously added
for instance, if we tell Jarvis to match ‘Gaucho protip’ to ‘Kyle Cho Pro Tip’
when we invoke findCommand with the phrase trie and ‘Gaucho protip’ it will
return ‘Kyle Cho Pro Tip’</p>
<p>@param {object} phrases -  Phrases trie
@param {string} _actionPrefix -  user supplied term
@return {string} - if in phrase trie, return string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> addedPhraseTest = findCommand(phrases, _actionPrefix);

  <span class="hljs-keyword">if</span> (addedPhraseTest) {
    actionObj.exact = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (variable &amp;&amp; argCommands[addedPhraseTest]) {
      actionObj.action = formatVariable(argCommands[addedPhraseTest], variable, commandsObj);
    } <span class="hljs-keyword">else</span> {
      actionObj.action = exactCommands[addedPhraseTest];
    }

  } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>getMatchByScore</p>
<p>  Will pass in an array of commands and a user supplied term
  and will return out string with the highest chance of being the correct match</p>
<p>  @param {array} commands -  array of known commands
  @param {string} _actionPrefix -  user supplied command
  @return {string} - command with the highest match score</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">console</span>.log(closeMatchThreshold);
    <span class="hljs-keyword">var</span> key = getMatchByScore(<span class="hljs-built_in">Object</span>.keys(actions), _actionPrefix, closeMatchThreshold);
    <span class="hljs-keyword">if</span> (key !== <span class="hljs-string">''</span>) {
      actionObj.exact = <span class="hljs-literal">false</span>;
      actionObj.guessedCommand = key;
      <span class="hljs-keyword">if</span> (variable &amp;&amp; argCommands[key]) {
        actionObj.action = formatVariable(argCommands[key], variable, commandsObj);
      } <span class="hljs-keyword">else</span> {
        actionObj.action = exactCommands[key];
      }
    }

  }

  <span class="hljs-keyword">return</span> actionObj;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
